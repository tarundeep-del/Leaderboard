<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Leaderboard</title>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0e2a57;
    color: #fff;
    overflow: hidden;
  }

  /* Company Logo */
  .company-logo {
    position: absolute;
    top: 20px;
    right: 30px;
    width: 120px;
    z-index: 10;
  }

  .company-logo img {
    width: 100%;
  }

  .container {
    display: flex;
    height: 100vh;
  }

  .sidebar {
    width: 160px;
    background: linear-gradient(180deg, #ff7a18, #0e2a57);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .sidebar .text {
    writing-mode: vertical-rl;
    transform: rotate(180deg);
    font-size: 32px;
    font-weight: bold;
    letter-spacing: 2px;
  }

  .board {
    flex: 1;
    padding: 80px 40px 40px;
    display: flex;
    flex-direction: column;
  }

  .row {
    margin-bottom: 18px;
  }

  .team {
    display: flex;
    align-items: center;
    gap: 18px;
    padding: 16px 22px;
    border-radius: 40px;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0,0,0,0.35);
    transition: all 0.6s ease;
  }

  .logo {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background: #fff;
    overflow: hidden;
    flex-shrink: 0;
  }

  .logo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .details {
    flex: 1;
  }

  .name {
    font-size: 18px;
  }

  .stats {
    font-size: 14px;
    opacity: 0.9;
    margin-top: 4px;
  }

  .percent {
    font-size: 18px;
    white-space: nowrap;
  }
</style>
</head>

<body>

<!-- Company Logo -->
<div class="company-logo">
  <img src="logos/company.png" alt="Company Logo">
</div>

<div class="container">
  <div class="sidebar">
    <div class="text">LEADERBOARD</div>
  </div>

  <div class="board" id="leaderboard"></div>
</div>

<script>
  /************** CONFIG **************/
  const SHEET_ID = "YOUR_SHEET_ID";
  const SHEET_NAME = "Sheet1";
  const REFRESH_INTERVAL = 30000; // 30 seconds
  /**********************************/

  const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${SHEET_NAME}`;

  async function fetchData() {
    const res = await fetch(URL);
    const text = await res.text();
    const json = JSON.parse(text.substring(47).slice(0, -2));

    return json.table.rows.map(r => {
      const total = r.c[1]?.v || 0;
      const target = r.c[2]?.v || 0;
      const percent = target ? Math.round((total / target) * 100) : 0;

      return {
        name: r.c[0]?.v || "",
        total,
        percent,
        color: r.c[3]?.v || "#888",
        logo: r.c[4]?.v || ""
      };
    });
  }

  function render(data) {
    const board = document.getElementById("leaderboard");

    data.forEach((team, index) => {
      const safeId = team.name.replace(/\s+/g, "_");
      let row = document.getElementById(safeId);

      if (!row) {
        row = document.createElement("div");
        row.className = "row";
        row.id = safeId;

        row.innerHTML = `
          <div class="team">
            <div class="logo"><img></div>
            <div class="details">
              <div class="name"></div>
              <div class="stats"></div>
            </div>
            <div class="percent"></div>
          </div>
        `;

        board.appendChild(row);
      }

      row.style.order = index;

      const teamDiv = row.querySelector(".team");
      teamDiv.style.background = team.color;

      row.querySelector(".name").textContent = team.name;
      row.querySelector(".stats").textContent =
        `${team.total} Lives Impacted`;

      row.querySelector(".percent").textContent =
        `${team.percent}% Achieved`;

      const img = row.querySelector("img");
      img.src = team.logo;
      img.onerror = () => img.src = "logos/default.png";
    });
  }

  async function updateLeaderboard() {
    try {
      const data = await fetchData();
      data.sort((a, b) => b.percent - a.percent); // Rank by achievement %
      render(data);
    } catch (err) {
      console.error("Leaderboard update failed", err);
    }
  }

  updateLeaderboard();
  setInterval(updateLeaderboard, REFRESH_INTERVAL);
</script>

</body>
</html>
